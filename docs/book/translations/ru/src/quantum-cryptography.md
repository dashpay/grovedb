# Квантовая криптография — Анализ постквантовых угроз

Эта глава анализирует, как квантовые компьютеры повлияют на криптографические
примитивы, используемые в GroveDB, и протоколы защищённых транзакций, построенные
поверх него (Orchard, Dash Platform). Рассматриваются уязвимые и безопасные
компоненты, значение принципа «собирай сейчас, расшифровывай потом» для
хранимых данных и существующие стратегии смягчения — включая гибридные
схемы KEM.

## Два квантовых алгоритма, которые имеют значение

На практике для криптографии релевантны только два квантовых алгоритма:

**Алгоритм Шора** решает задачу дискретного логарифма (и факторизацию
целых чисел) за полиномиальное время. Для 255-битной эллиптической кривой,
такой как Pallas, требуется примерно 510 логических кубитов — но с учётом
накладных расходов на коррекцию ошибок реальное требование составляет
приблизительно 4 миллиона физических кубитов. Алгоритм Шора **полностью
ломает** всю криптографию на эллиптических кривых независимо от размера ключа.

**Алгоритм Гровера** обеспечивает квадратичное ускорение для полного перебора.
256-битный симметричный ключ фактически становится 128-битным. Однако глубина
схемы для алгоритма Гровера на пространстве 128-битных ключей по-прежнему
составляет 2^64 квантовых операций — многие криптографы считают, что это
никогда не станет практичным на реальном оборудовании из-за пределов
декогеренции. Гровер уменьшает запас прочности, но не ломает хорошо
параметризованную симметричную криптографию.

| Алгоритм | Цели | Ускорение | Практическое влияние |
|----------|------|-----------|---------------------|
| **Шор** | Дискретный логарифм ECC, факторизация RSA | Полиномиальное время (экспоненциальное ускорение по сравнению с классическим) | **Полный взлом** ECC |
| **Гровер** | Поиск симметричного ключа, прообраз хеша | Квадратичное (уменьшает биты ключа вдвое) | 256 бит → 128 бит (всё ещё безопасно) |

## Криптографические примитивы GroveDB

GroveDB и протокол защищённых транзакций на основе Orchard используют сочетание
примитивов на эллиптических кривых и симметричных/хеш-примитивов. Таблица
ниже классифицирует каждый примитив по его квантовой уязвимости:

### Уязвимые для квантовых атак (алгоритм Шора — 0 бит постквантовой безопасности)

| Примитив | Где используется | Что ломается |
|----------|-----------------|-------------|
| **Pallas ECDLP** | Обязательства нот (cmx), эфемерные ключи (epk/esk), ключи просмотра (ivk), платёжные ключи (pk_d), вывод нуллификаторов | Восстановление любого приватного ключа из его публичного аналога |
| **Согласование ключей ECDH** (Pallas) | Вывод симметричных ключей шифрования для шифротекстов нот | Восстановление общего секрета → расшифровка всех нот |
| **Хеш Sinsemilla** | Пути Меркла в CommitmentTree, хеширование в схемах | Стойкость к коллизиям зависит от ECDLP; деградирует при взломе Pallas |
| **Halo 2 IPA** | Система ZK-доказательств (полиномиальное обязательство над кривыми Pasta) | Подделка доказательств для ложных утверждений (фальсификация, несанкционированные траты) |
| **Обязательства Педерсена** | Обязательства по стоимости (cv_net), скрывающие суммы транзакций | Восстановление скрытых сумм; подделка доказательств баланса |

### Квантово-безопасные (алгоритм Гровера — 128+ бит постквантовой безопасности)

| Примитив | Где используется | Постквантовая безопасность |
|----------|-----------------|--------------------------|
| **Blake3** | Хеши узлов дерева Merk, узлы MMR, корни состояния BulkAppendTree, префиксы путей поддеревьев | 128-битный прообраз, 128-битный второй прообраз |
| **BLAKE2b-256** | KDF для вывода симметричных ключей, ключ исходящего шифра, PRF^expand | 128-битный прообраз |
| **ChaCha20-Poly1305** | Шифрует enc_ciphertext и out_ciphertext (256-битные ключи) | 128-битный поиск ключа (безопасно, но путь вывода ключа через ECDH — нет) |
| **PRF^expand** (BLAKE2b-512) | Выводит esk, rcm, psi из rseed | 128-битная PRF-безопасность |

### Инфраструктура GroveDB: полностью квантово-безопасная

Все собственные структуры данных GroveDB основаны исключительно на хешировании Blake3:

- **Деревья AVL Merk** — хеши узлов, combined_value_hash, распространение дочерних хешей
- **Деревья MMR** — хеши внутренних узлов, вычисление пиков, вывод корня
- **BulkAppendTree** — цепочки хешей буфера, плотные корни Меркла, MMR эпох
- **Корень состояния CommitmentTree** — `blake3("ct_state" || sinsemilla_root || bulk_state_root)`
- **Префиксы путей поддеревьев** — хеширование сегментов пути через Blake3
- **Доказательства V1** — цепочки аутентификации через иерархию Merk

**Изменения не требуются.** Доказательства дерева Merk в GroveDB, проверки
согласованности MMR, корни эпох BulkAppendTree и все цепочки аутентификации
доказательств V1 остаются защищёнными от квантовых компьютеров.
Хеш-инфраструктура — самая стойкая часть системы в постквантовую эпоху.

## Ретроактивные и реальновременные угрозы

Это различие критически важно для определения приоритетов исправлений.

**Ретроактивные угрозы** компрометируют уже хранящиеся данные. Противник
записывает данные сегодня и расшифровывает их, когда квантовые компьютеры
станут доступны. Эти угрозы **невозможно смягчить постфактум** — когда данные
попадают в блокчейн, их нельзя перешифровать или отозвать.

**Реальновременные угрозы** затрагивают только транзакции, создаваемые в
будущем. Противник с квантовым компьютером мог бы подделывать подписи или
доказательства, но только для новых транзакций. Старые транзакции уже были
валидированы и подтверждены сетью.

| Угроза | Тип | Что раскрывается | Срочность |
|--------|-----|-----------------|-----------|
| **Расшифровка нот** (enc_ciphertext) | **Ретроактивная** | Содержимое нот: получатель, сумма, memo, rseed | **Высокая** — хранится навсегда |
| **Раскрытие обязательства стоимости** (cv_net) | **Ретроактивная** | Суммы транзакций (но не отправитель/получатель) | **Средняя** — только суммы |
| **Данные восстановления отправителя** (out_ciphertext) | **Ретроактивная** | Ключи восстановления отправителя для отправленных нот | **Высокая** — хранится навсегда |
| Подделка авторизации расходов | Реальновременная | Возможна подделка новых подписей расходов | Низкая — обновить до появления КК |
| Подделка доказательств Halo 2 | Реальновременная | Возможна подделка новых доказательств (фальсификация) | Низкая — обновить до появления КК |
| Коллизия Sinsemilla | Реальновременная | Возможна подделка новых путей Меркла | Низкая — поглощается подделкой доказательств |
| Подделка связующей подписи | Реальновременная | Возможна подделка новых доказательств баланса | Низкая — обновить до появления КК |

### Что именно раскрывается?

**Если шифрование нот взломано** (основная угроза HNDL):

Квантовый противник восстанавливает `esk` из хранимого `epk` с помощью
алгоритма Шора, вычисляет общий секрет ECDH, выводит симметричный ключ
и расшифровывает `enc_ciphertext`. Это раскрывает полный открытый текст ноты:

| Поле | Размер | Что раскрывается |
|------|--------|-----------------|
| version | 1 байт | Версия протокола (не чувствительно) |
| diversifier | 11 байт | Компонент адреса получателя |
| value | 8 байт | Точная сумма транзакции |
| rseed | 32 байта | Позволяет связать нуллификаторы (деанонимизирует граф транзакций) |
| memo | 36 байт (DashMemo) | Данные приложения, потенциально идентифицирующие |

Имея `rseed` и `rho` (хранящиеся вместе с шифротекстом), противник может
вычислить `esk = PRF(rseed, rho)` и проверить привязку эфемерного ключа.
В сочетании с диверсификатором это связывает входы с выходами по всей
истории транзакций — **полная деанонимизация защищённого пула**.

**Если взломаны только обязательства стоимости** (вторичная угроза HNDL):

Противник восстанавливает `v` из `cv_net = [v]*V + [rcv]*R`, решая ECDLP.
Это раскрывает **суммы транзакций, но не личности отправителя или
получателя**. Противник видит «кто-то отправил 5.0 Dash кому-то», но не
может связать сумму с каким-либо адресом или личностью без взлома
шифрования нот.

Сами по себе суммы без привязки имеют ограниченную полезность. Но в сочетании
с внешними данными (тайминг, известные счета, суммы, совпадающие с публичными
запросами) корреляционные атаки становятся возможными.

## Атака «Собирай сейчас, расшифровывай потом»

Это наиболее актуальная и практическая квантовая угроза.

**Модель атаки:** Государственный противник (или любая сторона с достаточным
хранилищем) записывает все данные защищённых транзакций из блокчейна сегодня.
Эти данные публично доступны в блокчейне и неизменяемы. Противник ждёт
появления криптографически релевантного квантового компьютера (КРКК), затем:

```text
Step 1: Read stored record from CommitmentTree BulkAppendTree:
        cmx (32) || rho (32) || epk (32) || enc_ciphertext (104) || out_ciphertext (80)

Step 2: Solve ECDLP on Pallas via Shor's algorithm:
        epk = [esk] * g_d  →  recover esk

Step 3: Compute shared secret:
        shared_secret = [esk] * pk_d

Step 4: Derive symmetric key (BLAKE2b is quantum-safe, but input is compromised):
        K_enc = BLAKE2b-256("Zcash_OrchardKDF", shared_secret || epk)

Step 5: Decrypt enc_ciphertext using ChaCha20-Poly1305:
        → version || diversifier || value || rseed || memo

Step 6: With rseed + rho, link nullifiers to note commitments:
        esk = PRF(rseed, rho)
        → full transaction graph reconstruction
```

**Ключевой вывод:** Симметричное шифрование (ChaCha20-Poly1305) абсолютно
квантово-безопасно. Уязвимость полностью заключается в **пути вывода
ключа** — симметричный ключ выводится из общего секрета ECDH, а ECDH
ломается алгоритмом Шора. Атакующий не ломает шифрование; он восстанавливает
ключ.

**Ретроактивность:** Эта атака **полностью ретроактивна**. Каждая
зашифрованная нота, когда-либо сохранённая в блокчейне, может быть
расшифрована после появления КРКК. Данные невозможно перешифровать или
защитить постфактум. Именно поэтому проблему необходимо решать до
сохранения данных, а не после.

## Смягчение: гибридный KEM (ML-KEM + ECDH)

Защита от HNDL состоит в выводе симметричного ключа шифрования из **двух
независимых механизмов согласования ключей**, так что взлом только одного
недостаточен. Это называется гибридным KEM.

### ML-KEM-768 (CRYSTALS-Kyber)

ML-KEM — это стандартизированный NIST (FIPS 203, август 2024) постквантовый
механизм инкапсуляции ключей, основанный на задаче Module Learning With
Errors (MLWE).

| Параметр | ML-KEM-512 | ML-KEM-768 | ML-KEM-1024 |
|----------|-----------|-----------|------------|
| Открытый ключ (ek) | 800 байт | **1 184 байта** | 1 568 байт |
| Шифротекст (ct) | 768 байт | **1 088 байт** | 1 568 байт |
| Общий секрет | 32 байта | 32 байта | 32 байта |
| Категория NIST | 1 (128 бит) | **3 (192 бита)** | 5 (256 бит) |

**ML-KEM-768** — рекомендуемый выбор. Это набор параметров, используемый
X-Wing, PQXDH от Signal и гибридным обменом ключей TLS в Chrome/Firefox.
Категория 3 обеспечивает комфортный запас прочности против будущих
достижений в криптоанализе решёток.

### Как работает гибридная схема

**Текущий поток (уязвимый):**

```text
Sender:
  esk = PRF(rseed, rho)                    // deterministic from note
  epk = [esk] * g_d                         // Pallas curve point
  shared_secret = [esk] * pk_d              // ECDH (broken by Shor's)
  K_enc = BLAKE2b("Zcash_OrchardKDF", shared_secret || epk)
  enc_ciphertext = ChaCha20(K_enc, note_plaintext)
```

**Гибридный поток (квантово-стойкий):**

```text
Sender:
  esk = PRF(rseed, rho)                    // unchanged
  epk = [esk] * g_d                         // unchanged
  ss_ecdh = [esk] * pk_d                    // same ECDH

  (ct_pq, ss_pq) = ML-KEM-768.Encaps(ek_pq)  // NEW: lattice-based KEM
                                                // ek_pq from recipient's address

  K_enc = BLAKE2b(                          // MODIFIED: combines both secrets
      "DashPlatform_HybridKDF",
      ss_ecdh || ss_pq || ct_pq || epk
  )

  enc_ciphertext = ChaCha20(K_enc, note_plaintext)  // unchanged
```

**Расшифровка получателем:**

```text
Recipient:
  ss_ecdh = [ivk] * epk                    // same ECDH (using incoming viewing key)
  ss_pq = ML-KEM-768.Decaps(dk_pq, ct_pq)  // NEW: KEM decapsulation
  K_enc = BLAKE2b("DashPlatform_HybridKDF", ss_ecdh || ss_pq || ct_pq || epk)
  note_plaintext = ChaCha20.Decrypt(K_enc, enc_ciphertext)
```

### Гарантия безопасности

Комбинированный KEM является IND-CCA2-безопасным, если **любой** из
составляющих KEM безопасен. Это формально доказано [Giacon, Heuer и
Poettering (2018)](https://eprint.iacr.org/2018/024) для комбинаторов KEM
с использованием PRF (BLAKE2b подходит), а также независимо
[доказательством безопасности X-Wing](https://eprint.iacr.org/2024/039).

| Сценарий | ECDH | ML-KEM | Комбинированный ключ | Статус |
|----------|------|--------|---------------------|--------|
| Классический мир | Безопасен | Безопасен | **Безопасен** | Оба целы |
| Квантовый взлом ECC | **Взломан** | Безопасен | **Безопасен** | ML-KEM защищает |
| Прорыв в решётках ломает ML-KEM | Безопасен | **Взломан** | **Безопасен** | ECDH защищает (как сегодня) |
| Оба взломаны | Взломан | Взломан | **Взломан** | Требует двух одновременных прорывов |

### Влияние на размер

Гибридный KEM добавляет шифротекст ML-KEM-768 (1 088 байт) к каждой
сохранённой ноте и расширяет исходящий шифротекст для включения общего
секрета ML-KEM для восстановления отправителем:

**Сохранённая запись на ноту:**

```text
┌──────────────────────────────────────────────────────────────────┐
│  Current (280 bytes)         Hybrid (1,400 bytes)               │
│                                                                  │
│  cmx:             32         cmx:              32               │
│  rho:             32         rho:              32               │
│  epk:             32         epk:              32               │
│  enc_ciphertext: 104         ct_pq:         1,088  ← NEW       │
│  out_ciphertext:  80         enc_ciphertext:  104               │
│                              out_ciphertext:  112  ← +32        │
│  ─────────────────           ──────────────────────             │
│  Total:          280         Total:          1,400  (5.0x)      │
└──────────────────────────────────────────────────────────────────┘
```

**Хранение в масштабе:**

| Ноты | Текущий (280 Б) | Гибридный (1 400 Б) | Разница |
|------|----------------|---------------------|---------|
| 100 000 | 26,7 МБ | 133 МБ | +106 МБ |
| 1 000 000 | 267 МБ | 1,33 ГБ | +1,07 ГБ |
| 10 000 000 | 2,67 ГБ | 13,3 ГБ | +10,7 ГБ |

**Размер адреса:**

```text
Current:  diversifier (11) + pk_d (32) = 43 bytes
Hybrid:   diversifier (11) + pk_d (32) + ek_pq (1,184) = 1,227 bytes
```

Открытый ключ ML-KEM размером 1 184 байта должен быть включён в адрес,
чтобы отправители могли выполнить инкапсуляцию. При ~1 960 символах Bech32m
это много, но всё ещё помещается в QR-код (максимум ~2 953 алфавитно-цифровых
символа).

### Управление ключами

Пара ключей ML-KEM выводится детерминированно из ключа расходования:

```text
SpendingKey (sk) [32 bytes]
  |
  +-> ... (all existing Orchard key derivation unchanged)
  |
  +-> ml_kem_d = PRF^expand(sk, [0x09])[0..32]
  +-> ml_kem_z = PRF^expand(sk, [0x0A])[0..32]
        |
        +-> (ek_pq, dk_pq) = ML-KEM-768.KeyGen(d=ml_kem_d, z=ml_kem_z)
              ek_pq: 1,184 bytes (public, included in address)
              dk_pq: 2,400 bytes (private, part of viewing key)
```

**Изменения резервного копирования не требуются.** Существующая мнемоническая
фраза из 24 слов покрывает ключ ML-KEM, поскольку он выводится из ключа
расходования детерминированно. Восстановление кошелька работает как прежде.

**Диверсифицированные адреса** используют один и тот же `ek_pq`, поскольку
ML-KEM не имеет естественного механизма диверсификации, подобного скалярному
умножению Pallas. Это означает, что наблюдатель, имеющий два адреса
пользователя, может связать их, сравнив `ek_pq`.

### Производительность пробной расшифровки

| Этап | Текущий | Гибридный | Разница |
|------|---------|-----------|---------|
| Pallas ECDH | ~100 мкс | ~100 мкс | — |
| ML-KEM-768 Decaps | — | ~40 мкс | +40 мкс |
| BLAKE2b KDF | ~0,5 мкс | ~1 мкс | — |
| ChaCha20 (52 байта) | ~0,1 мкс | ~0,1 мкс | — |
| **Всего на ноту** | **~101 мкс** | **~141 мкс** | **+40% накладных расходов** |

Сканирование 100 000 нот: ~10,1 сек → ~14,1 сек. Накладные расходы
существенны, но не запретительны. Декапсуляция ML-KEM выполняется за
постоянное время без преимуществ пакетной обработки (в отличие от операций
на эллиптических кривых), поэтому масштабируется линейно.

### Влияние на ZK-схемы

**Отсутствует.** Гибридный KEM находится целиком в слое
транспорта/шифрования. Схема Halo 2 доказывает существование нот, корректность
нуллификаторов и баланс стоимостей — она не доказывает ничего о шифровании.
Никаких изменений в ключах доказательства, ключах верификации или
ограничениях схемы.

### Сравнение с индустрией

| Система | Подход | Статус |
|---------|--------|--------|
| **Signal** (PQXDH) | X25519 + ML-KEM-768, обязательный для всех пользователей | **Развёрнут** (2023) |
| **Chrome/Firefox TLS** | X25519 + ML-KEM-768 гибридный обмен ключами | **Развёрнут** (2024) |
| **X-Wing** (черновик IETF) | X25519 + ML-KEM-768, специализированный комбинатор | Черновик стандарта |
| **Zcash** | Черновик ZIP о квантовой восстановимости (восстановление средств, не шифрование) | Только обсуждение |
| **Dash Platform** | Pallas ECDH + ML-KEM-768 (предложено) | Фаза проектирования |

## Когда развёртывать

### Вопрос временной шкалы

- **Текущее состояние (2026):** Ни один квантовый компьютер не может сломать
  255-битную ECC. Крупнейшая продемонстрированная квантовая факторизация:
  ~50 бит. Разрыв: на порядки.
- **Ближайшая перспектива (2030-2035):** Дорожные карты IBM, Google,
  Quantinuum нацелены на миллионы кубитов. Реализации ML-KEM и наборы
  параметров созреют.
- **Среднесрочная перспектива (2035-2050):** Большинство оценок помещают
  появление КРКК в этот период. Данные HNDL, собранные сегодня, находятся
  под угрозой.
- **Долгосрочная перспектива (2050+):** Консенсус среди криптографов:
  крупномасштабные квантовые компьютеры — вопрос «когда», а не «если».

### Рекомендуемая стратегия

**1. Проектировать с учётом обновляемости сейчас.** Обеспечить, чтобы формат
хранимых записей, структура `TransmittedNoteCiphertext` и макет записей
BulkAppendTree были версионированными и расширяемыми. Это малозатратно и
сохраняет возможность добавить гибридный KEM позже.

**2. Развернуть гибридный KEM, когда готов, сделать обязательным.** Не
предлагать два пула (классический и гибридный). Разделение множества
анонимности сводит на нет цель защищённых транзакций — пользователи,
скрывающиеся в меньшей группе, менее приватны, а не более. При развёртывании
каждая нота использует гибридную схему.

**3. Ориентироваться на окно 2028-2030.** Это задолго до любой реалистичной
квантовой угрозы, но после стабилизации реализаций ML-KEM и размеров
параметров. Это также позволяет учесть опыт развёртывания Zcash и Signal.

**4. Мониторить триггерные события:**
- NIST или NSA устанавливают сроки обязательной постквантовой миграции
- Значительные достижения в квантовом оборудовании (>100 000 физических
  кубитов с коррекцией ошибок)
- Криптоаналитические достижения в области решёточных задач (повлияют на
  выбор ML-KEM)

### Что не требует срочных действий

| Компонент | Почему можно подождать |
|-----------|----------------------|
| Подписи авторизации расходов | Подделка происходит в реальном времени, не ретроактивно. Обновить до ML-DSA/SLH-DSA до появления КРКК. |
| Система доказательств Halo 2 | Подделка доказательств реальновременная. Мигрировать на систему на основе STARK при необходимости. |
| Стойкость к коллизиям Sinsemilla | Полезна только для новых атак, не ретроактивных. Поглощается миграцией системы доказательств. |
| Инфраструктура GroveDB Merk/MMR/Blake3 | **Уже квантово-безопасна при текущих криптографических предположениях.** Действий не требуется на основании известных атак. |

## Справочник постквантовых альтернатив

### Для шифрования (замена ECDH)

| Схема | Тип | Открытый ключ | Шифротекст | Категория NIST | Примечания |
|-------|-----|--------------|-----------|----------------|-----------|
| ML-KEM-768 | Решётки (MLWE) | 1 184 Б | 1 088 Б | 3 (192 бита) | FIPS 203, отраслевой стандарт |
| ML-KEM-512 | Решётки (MLWE) | 800 Б | 768 Б | 1 (128 бит) | Меньший, меньший запас |
| ML-KEM-1024 | Решётки (MLWE) | 1 568 Б | 1 568 Б | 5 (256 бит) | Избыточно для гибрида |

### Для подписей (замена RedPallas/Schnorr)

| Схема | Тип | Открытый ключ | Подпись | Категория NIST | Примечания |
|-------|-----|--------------|---------|----------------|-----------|
| ML-DSA-65 (Dilithium) | Решётки | 1 952 Б | 3 293 Б | 3 | FIPS 204, быстрый |
| SLH-DSA (SPHINCS+) | На основе хешей | 32-64 Б | 7 856-49 856 Б | 1-5 | FIPS 205, консервативный |
| XMSS/LMS | На основе хешей (с состоянием) | 60 Б | 2 500 Б | варьируется | С состоянием — повторное использование = взлом |

### Для ZK-доказательств (замена Halo 2)

| Система | Предположение | Размер доказательства | Постквантовая | Примечания |
|---------|-------------|---------------------|-------------|-----------|
| STARKs | Хеш-функции (стойкость к коллизиям) | ~100-400 КБ | **Да** | Используется StarkNet |
| Plonky3 | FRI (полиномиальное обязательство на основе хешей) | ~50-200 КБ | **Да** | Активная разработка |
| Halo 2 (текущий) | ECDLP на кривых Pasta | ~5 КБ | **Нет** | Текущая система Orchard |
| Lattice SNARKs | MLWE | Исследование | **Да** | Не готов к промышленному использованию |

### Экосистема Rust-крейтов

| Крейт | Источник | FIPS 203 | Верифицирован | Примечания |
|-------|----------|----------|-------------|-----------|
| `libcrux-ml-kem` | Cryspen | Да | Формально верифицирован (hax/F*) | Наивысшая гарантия |
| `ml-kem` | RustCrypto | Да | Постоянное время, не аудирован | Совместимость с экосистемой |
| `fips203` | integritychain | Да | Постоянное время | Чистый Rust, no_std |

## Итоги

```text
┌─────────────────────────────────────────────────────────────────────┐
│  СВОДКА КВАНТОВЫХ УГРОЗ ДЛЯ GROVEDB + ORCHARD                     │
│                                                                     │
│  БЕЗОПАСНО ПРИ ТЕКУЩИХ ПРЕДПОЛОЖЕНИЯХ (на основе хешей):             │
│    ✓ Blake3 деревья Merk, MMR, BulkAppendTree                      │
│    ✓ BLAKE2b KDF, PRF^expand                                       │
│    ✓ ChaCha20-Poly1305 симметричное шифрование                     │
│    ✓ Все цепочки аутентификации доказательств GroveDB               │
│                                                                     │
│  ИСПРАВИТЬ ДО СОХРАНЕНИЯ ДАННЫХ (ретроактивный HNDL):               │
│    ✗ Шифрование нот (согласование ключей ECDH) → гибридный KEM    │
│    ✗ Обязательства стоимости (Pedersen) → суммы раскрыты           │
│                                                                     │
│  ИСПРАВИТЬ ДО ПОЯВЛЕНИЯ КВАНТОВЫХ КОМПЬЮТЕРОВ (реальное время):     │
│    ~ Авторизация расходов → ML-DSA / SLH-DSA                       │
│    ~ ZK-доказательства → STARKs / Plonky3                          │
│    ~ Sinsemilla → хеш-дерево Меркла                                │
│                                                                     │
│  РЕКОМЕНДУЕМАЯ ВРЕМЕННАЯ ШКАЛА:                                     │
│    2026-2028: Проектировать обновляемость, версионировать форматы   │
│    2028-2030: Развернуть обязательный гибридный KEM для шифрования  │
│    2035+: Мигрировать подписи и систему доказательств при необх.    │
└─────────────────────────────────────────────────────────────────────┘
```

---
